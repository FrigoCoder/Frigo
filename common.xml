<project xmlns:ivy="antlib:org.apache.ivy.ant" xmlns:ac="antlib:net.sf.antcontrib" basedir=".">

	<fileset id="libraries" dir=".">
		<include name="lib/**/*.jar" />
	</fileset>

	<fileset id="all.classes" dir=".">
		<include name="bin/**/*.class" />
	</fileset>

    <path id="all.classpath">
		<fileset refid="libraries" />
		<fileset refid="all.classes" />
    </path>

    <macrodef name="compile">
        <attribute name="module" />
        <attribute name="classpathref" default="all.classpath" />
        <sequential>
            <echo message="Starting compilation of @{module}" />
            <mkdir dir="bin/@{module}" />
            <javac srcdir="src/@{module}/java"
                   destdir="bin/@{module}"
                   classpathref="@{classpathref}"
                   includeAntRuntime="no"
                   encoding="utf8"
                   debug="yes"
            />
            <echo message="Finished compilation of @{module}" />
        </sequential>
    </macrodef>

    <macrodef name="test">
        <attribute name="module" />
        <attribute name="classpathref" default="all.classpath" />
        <sequential>
            <echo message="Starting JUnit on module @{module}" />
            <mkdir dir="report/@{module}" />
            <junit filtertrace="yes" printsummary="no" showoutput="no">
                <batchtest todir="report/@{module}">
                    <fileset dir="bin/@{module}">
                        <include name="**/*Test.class" />
                    </fileset>
					<formatter type="brief" usefile="no" />
                    <formatter type="xml" />
                </batchtest>
                <classpath refid="@{classpathref}" />
            </junit>
            <echo message="Finished JUnit on module @{module}" />
        </sequential>
    </macrodef>

    <target name="clean">
        <delete dir="bin" />
        <delete dir="lib" />
        <delete dir="report" />
		<ivy:cleancache />
    </target>

	<target name="retrieve">
        <ivy:resolve log="download-only" />
        <ivy:retrieve sync="true" />
		<antcall target="toclasspath" />
    </target>

	<property name="xmlheader" value='<?xml version="1.0" encoding="UTF-8"?>' />

	<target name="toclasspath">
		<delete file=".classpath" />
		<touch file=".classpath" />
		<echo file=".classpath" append="yes" message="${xmlheader}" />



	<!--<classpath>
		<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.7"/>-->
	</target>


</project>
